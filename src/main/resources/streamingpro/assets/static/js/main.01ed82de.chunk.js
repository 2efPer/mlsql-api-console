(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{304:function(e,t,n){e.exports=n(597)},309:function(e,t,n){},313:function(e,t,n){},315:function(e,t,n){},317:function(e,t,n){},332:function(e,t,n){},374:function(e,t,n){},386:function(e,t,n){},595:function(e,t,n){},597:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(9),i=n.n(s);n(309),n(313),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=n(15),o=n(16),l=n(19),u=n(18),d=n(20),m=n(12),f=(n(315),n(249)),p=n(90),h=n(251),g=n(606),b=n(167),v=n(168),E=(n(317),{GET:"get",POST:"post",PUT:"put"}),O={Success:200,BadRequest:400,Unauthorized:401,Forbidden:404,ServerError:500},j={name:"access-token"},k=n(179),S=function e(t){Object(c.a)(this,e),this.value=t},y=function e(t,n,a){var r=this;Object(c.a)(this,e),this.json=function(e,t){r.content.then(function(n){try{var a=JSON.parse(n);e(a)}catch(r){t(n)}})},this.status=t,this.content=n,this.accessToken=a},w=function(){function e(t){Object(c.a)(this,e),this.url=t}return Object(o.a)(e,[{key:"request2",value:function(e,t,n){this.request(E.POST,e,function(e){e.json(function(e){t(e)},function(e){n(e)})},function(e){try{e.value().content(function(e){n(e)})}catch(t){n(e?e.toString():"result is null")}})}},{key:"runScript",value:function(e,t,n,a){var r=new P,s=k(),i=this;r.user(function(r){var c=r.userName,o=r.backendTags;if(o){var l={sql:t,owner:c,jobName:s,sessionPerUser:!0,show_stack:!0,tags:o||""};Object.assign(l,e),(e.background||!1)&&Object.assign(l,{async:!0,callback:""}),i.request(E.POST,l,function(e){e.json(function(e){n(e)},function(e){a(e)})},function(e){try{e.value().content(function(e){a(e)})}catch(t){a(e?e.toString():"result is null")}})}else a("\n                \n                ---------------Warning--------------------\n                \n                Please make sure you have backend configured. \n                If not, please contact admin;\n                \n                ------------------------------------------\n                ")})}},{key:"request",value:function(e,t,n,a){e=e.toUpperCase();var r=[];for(var s in t){var i=encodeURIComponent(s),c=encodeURIComponent(t[s]);r.push(i+"="+c)}var o=this.url;return"GET"===e?(o=o+"?"+r,r=void 0):r=r.join("&"),fetch(o,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(j.name)||""},body:r}).then(function(e){n(new y(e.status,e.text(),e.headers.get(j.name)))}).catch(function(e){a(new S(e))})}}]),e}(),T="/api_v1/user/tags/update",C="/api_v1/users",N="/api_v1/script_file",x="/api_v1/script_file/remove",R="/api_v1/script_file/get",q="/api_v1/run/script",D="/api_v1/cluster",I="/api_v1/file/upload",P=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"isLogin",value:function(){return null!==sessionStorage.getItem(j.name)}},{key:"userName",value:function(e){new w("/api_v1/user/userName").request(E.GET,{},function(t){t.status===O.Unauthorized?sessionStorage.removeItem(j.name):t.content.then(function(t){e(JSON.parse(t).userName)}).catch(function(e){})},function(e){console.log(e)})}},{key:"user",value:function(e){new w("/api_v1/user/userName").request2({},function(t){e(t)},function(e){})}},{key:"login",value:function(e,t,n,a){this.registerOrLogin("/api_v1/user/login",e,t,n,a)}},{key:"logout",value:function(){sessionStorage.removeItem(j.name)}},{key:"register",value:function(e,t,n,a){this.registerOrLogin("/api_v1/user/register",e,t,n,a)}},{key:"registerOrLogin",value:function(e,t,n,a,r){var s={userName:t,password:n};new w(e).request(E.POST,s,function(e){e.accessToken&&sessionStorage.setItem(j.name,e.accessToken),a(e)},function(e){r(e)})}}]),e}(),L=(n(131),n(321),n(120)),A=n.n(L),B=(n(329),n(330),n(331),n(332),n(184),n(599)),F=n(604),V=function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!==typeof Error)throw new Error(t);throw t}},M=n(179),_=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).text=function(e,t){n.setState({value:e,scriptId:t}),n.aceEditorRef.current.editor.setValue(e)},n.executeSave=function(){var e=new w(N),t=Object(m.a)(Object(m.a)(n)),a=n.getMessageBoxAceEditor();t.state.scriptId?e.request(E.POST,{id:t.state.scriptId,content:t.getAceEditor().getValue()},function(e){a.setValue("saved")},function(e){}):a.setValue("no file are opened, cannot executeSave")},n.executeQueryBackGround=function(){n.setState({background:!0}),n.executeQuery()},n.executeQuery=function(){var e=M();n.enterLoading(e);var t=new w(q),a=Object(m.a)(Object(m.a)(n));a.getMessageBoxAceEditor().setValue("");var r=a.getSelection(),s=a.getAllText();""!==r&&(s=r);var i=(new Date).getTime();function c(){return a.exitLoading(),(new Date).getTime()-i}t.runScript({jobName:e,background:n.state.background||!1},s,function(e){try{a.queryApp.setData(e),a.getDisplay().update(e),a.getMessageBoxAceEditor().setValue("\nTime cost:"+c()+"ms")}catch(t){console.log(t),a.getMessageBoxAceEditor().setValue("Can not display the result. raw data:\n"+JSON.stringify(e))}a.exitLoading()},function(e){a.getMessageBoxAceEditor().setValue(e+"\nTime cost:"+c()+"ms"),a.exitLoading()})},n.getAllText=function(){return n.getAceEditor().getValue()},n.getSelection=function(){var e=n.getAceEditor().getSelectionRange();return n.getAceEditor().session.getTextRange(e)},n.getAceEditor=function(){return n.aceEditorRef.current.editor},n.getMessageBoxAceEditor=function(){return n.queryApp.messageBox.current.editor},n.getDashBoard=function(){return n.queryApp.dash.current},n.getDisplay=function(){return n.queryApp.display.current},n.enterLoading=function(e){n.commandGroup.current.setState({loading:!0}),n.resourceProgressRef.current.enter({jobName:e}),n.taskProgressRef.current.enter({jobName:e})},n.exitLoading=function(){n.commandGroup.current.setState({loading:!1}),n.resourceProgressRef.current.exit(),n.taskProgressRef.current.exit()},n.queryApp=n.props.parent,n.aceEditorRef=a.createRef(),n.commandGroup=a.createRef(),n.resourceProgressRef=a.createRef(),n.taskProgressRef=a.createRef(),n.state={value:"",loading:!1},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onChange",value:function(e){}},{key:"render",value:function(){return a.createElement("div",{className:"mlsql-editor-area"},a.createElement("div",null,a.createElement(A.a,{ref:this.aceEditorRef,mode:"sql",theme:"github",width:"100%",height:"300px",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,value:"",editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}})),a.createElement(U,{ref:this.commandGroup,parent:this}),a.createElement(G,{ref:this.resourceProgressRef,parent:this}),a.createElement(J,{ref:this.taskProgressRef,parent:this}))}}]),t}(a.Component),U=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={loading:!1},n.parent=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",{className:"mslql-editor-buttons"},a.createElement(B.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),a.createElement(B.a,{onClick:this.parent.executeSave},"Save"))}}]),t}(a.Component),G=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).enter=function(e){var t=Object(m.a)(Object(m.a)(n));n.setState({mark:!0}),setTimeout(function(){t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(function(){var n=new w(q);V(e.hasOwnProperty("jobName"),"jobName is required");var a=e.jobName;n.runScript({},"load _mlsql_.`resource/".concat(a,"` as output;"),function(e){var n=e[0];t.setState({percent:n.activeTasks/n.totalCores*100,successPercent:n.currentJobGroupActiveTasks/n.totalCores*100,title:"Resource (for all users): taken/Total: ".concat(n.activeTasks,"/").concat(n.totalCores,"(").concat(n.currentJobGroupActiveTasks," you took)")})},function(e){try{t.parent.getMessageBoxAceEditor().setValue(e)}catch(n){console.log(n)}})},2e3))},3e3)},n.exit=function(){n.setState({loading:!1,percent:0,successPercent:0,mark:!1}),n.intervalTimer&&clearInterval(n.intervalTimer)},n.state={loading:!1,percent:0,successPercent:0,mark:!1},n.parent=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.loading?a.createElement("div",null,this.state.title,a.createElement(F.a,{percent:this.state.percent,successPercent:this.state.successPercent})):a.createElement("div",null)}}]),t}(a.Component),J=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).enter=function(e){var t=Object(m.a)(Object(m.a)(n));n.setState({mark:!0}),setTimeout(function(){t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(function(){var n=new w(q);V(e.hasOwnProperty("jobName"),"jobName is required");var a=e.jobName;n.runScript({},"load _mlsql_.`jobs/".concat(a,"` as output;"),function(e){var n=e[0],a={numTasks:0,numActiveTasks:0,numCompletedTasks:0};n.activeJobs.forEach(function(e){a.numTasks+=e.numTasks,a.numActiveTasks+=e.numActiveTasks,a.numCompletedTasks+=e.numCompletedTasks}),t.setState({percent:a.numActiveTasks/a.numTasks*100,successPercent:a.numCompletedTasks/a.numTasks*100,title:"Tasks (for all stages): Succeeded/Total:\n".concat(a.numCompletedTasks,"/").concat(a.numTasks,"(").concat(a.numActiveTasks," running)")})},function(e){try{t.parent.getMessageBoxAceEditor().setValue(e)}catch(n){console.log(n)}})},2e3))},3e3)},n.exit=function(){n.setState({loading:!1,percent:0,successPercent:0,mark:!1}),n.intervalTimer&&clearInterval(n.intervalTimer)},n.state={loading:!1,percent:0,successPercent:0,mark:!1},n.parent=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.loading?a.createElement("div",null,this.state.title,a.createElement(F.a,{percent:this.state.percent,successPercent:this.state.successPercent})):a.createElement("div",null)}}]),t}(a.Component),z=_,W=n(166),H=n(385),Q=n(149),K=n(150),Y=n(106),Z=n(608),$=n(151),X=n(152),ee=n(2),te=n.n(ee),ne=(n(374),function e(){Object(c.a)(this,e),this.build=function(e){var t,n,a={},r=[];for(n=0;n<e.length;n+=1)a[e[n].id]=n,e[n].childNodes=[];for(n=0;n<e.length;n+=1)if(0!==(t=e[n]).parentId)try{e[a[t.parentId]].childNodes.push(t)}catch(s){console.log("------------"),console.log(t),console.log(a[t.parentId])}else r.push(t);return r}}),ae=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).reloadData=function(){var e=new w(N),t=Object(m.a)(Object(m.a)(n));e.request(E.GET,{},function(e){e.content.then(function(e){var n=[];try{n=JSON.parse(e||"[]")}catch(r){}var a=(new ne).build(n).sort(function(e,t){return e.id-t.id});t.setState({nodes:a})})},function(e){})},n.isRootNode=function(e){return n.state.nodes[0].id===e},n.onNodeContextMenu=function(e,t,r){r.preventDefault();var s=Object(m.a)(Object(m.a)(n));Z.a.show(a.createElement(se,{parent:s,nodeId:e.id}),{left:r.clientX,top:r.clientY},function(){return n.setState({isContextMenuOpen:!1})}),n.setState({isContextMenuOpen:!0})},n.handNodeDoubleClick=function(e,t,a){if(e.isDir)e.isExpanded=!e.isExpanded,n.toggleIsExpanded(e.id,e.isExpanded);else{var r=new w(R),s=Object(m.a)(Object(m.a)(n));r.request(E.GET,{id:e.id},function(t){t.content.then(function(t){var n=JSON.parse(t||"{}");s.parent.editor.current.text(n.content,e.id)})},function(e){})}n.setState(n.state)},n.handleNodeClick=function(e,t,a){var r=e.isSelected;a.shiftKey||n.forEachNode(n.state.nodes,function(e){return e.isSelected=!1}),e.isSelected=null==r||!r,n.setState(n.state)},n.toggleIsExpanded=function(e,t){var a=new w(N);Object(m.a)(Object(m.a)(n));a.request(E.POST,{id:e,isExpanded:t},function(e){e.content.then(function(e){})},function(e){})},n.handleNodeCollapse=function(e){e.isExpanded=!1,n.setState(n.state)},n.handleNodeExpand=function(e){e.isExpanded=!0,n.setState(n.state)},n.state={isContextMenuOpen:!1,openCreateScriptDialog:!1},n.parent=n.props.parent,n.reloadData(),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(W.a,{contents:this.state.nodes,onNodeClick:this.handleNodeClick,onNodeCollapse:this.handleNodeCollapse,onNodeExpand:this.handleNodeExpand,onNodeContextMenu:this.onNodeContextMenu,onNodeDoubleClick:this.handNodeDoubleClick,className:"mlsql-directory-tree"}),this.state.openCreateScriptDialog?a.createElement(re,{nodeId:this.state.nodeId,parent:this,queryApp:this.parent}):"")}},{key:"forEachNode",value:function(e,t){if(null!=e){var n=!0,a=!1,r=void 0;try{for(var s,i=e[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var c=s.value;t(c),this.forEachNode(c.childNodes,t)}}catch(o){a=!0,r=o}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}}}}]),t}(a.Component),re=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).title=function(){return n.props.parent.state.isDir?"Create Folder":"Create Script"},n.fileName=function(e){n.setState({fileName:e.target.value})},n.content=function(e){n.setState({content:e.target.value})},n.finish=function(){n.props.parent.setState({openCreateScriptDialog:!1}),n.props.parent.reloadData()},n.create=function(){var e=new w(N),t=Object(m.a)(Object(m.a)(n)),a={fileName:n.state.fileName,isDir:n.props.parent.state.isDir,content:n.state.content,parentId:n.props.nodeId};a.fileName?a.isDir||a.fileName.endsWith(".mlsql")?e.request(E.POST,a,function(e){e.status===O.Success?t.finish():e.content.then(function(e){n.setState({msg:e})})},function(e){t.setState({msg:"Server error"})}):n.setState({msg:"filename should be ends with .mlsql"}):n.setState({msg:"filename should not be empty"})},n.close=function(){var e=n.props.parent;e.setState({openCreateScriptDialog:!1}),e.reloadData()},n.state={msg:""},n.messageBox=n.props.queryApp.messageBox.current.editor,n.directoryTree=n.props.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=te()(H.a.CARD,H.a.ELEVATION_4,"docs-md-overlay-example-transition");return a.createElement("div",null,a.createElement(Q.a,{className:"msql-treenode-dialog",isOpen:!0,usePortal:!0},a.createElement("div",{className:e},a.createElement(K.a,null,this.title()," "),a.createElement("div",{className:"msql-treenode-dialog-form"},a.createElement("p",{style:{color:"red"}},this.state.msg),a.createElement(b.a,{helperText:"The file of name you want create.",label:"fileName",labelFor:"fileName",labelInfo:"(required)"},a.createElement(v.a,{id:"fileName",placeholder:"example.mlsql",onChange:this.fileName}))),a.createElement("br",null),a.createElement(h.a,{onClick:this.create},"Create"),a.createElement(h.a,{intent:Y.a.DANGER,onClick:this.close,style:{float:"right"}},"Close"))))}}]),t}(a.Component),se=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).removeFile=function(){var e=new w(x),t=Object(m.a)(Object(m.a)(n));e.request(E.POST,{id:t.nodeId},function(e){e.status===O.Success?t.parent.reloadData():e.content.then(function(e){t.parent.setState({msg:e})})},function(e){t.parent.setState({msg:"Server error"})})},n.isCreateProject=function(){return n.parent.isRootNode(n.nodeId)},n.createDocMenuItem=function(){if(!n.isCreateProject())return a.createElement($.a,{icon:"document",text:"Create Script",onClick:function(){n.parent.setState({openCreateScriptDialog:!0,nodeId:n.nodeId,isDir:!1})}.bind(Object(m.a)(Object(m.a)(n)))})},n.createFolderTitle=function(){return n.isCreateProject()?"Create Project":"Create Folder"},n.deleteMenu=function(){if(!n.isCreateProject())return a.createElement($.a,{icon:"remove",text:"Delete",onClick:function(){n.removeFile()}.bind(Object(m.a)(Object(m.a)(n)))})},n.parent=n.props.parent,n.nodeId=n.props.nodeId,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",null,a.createElement(X.a,null,this.createDocMenuItem(),a.createElement($.a,{icon:"folder-new",text:this.createFolderTitle(),onClick:function(){e.parent.setState({openCreateScriptDialog:!0,nodeId:e.nodeId,isDir:!0})}.bind(this)}),this.deleteMenu()))}}]),t}(a.Component),ie=(n(386),n(601)),ce=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).setRender=function(e,t){var r=t[0][e.key];if(n.state.config&&n.state.config.render){var s=n.state.config.render[e.key];s&&(e.render=s)}else a.Component.isPrototypeOf(r.type)?e.render=function(e){return a.createElement("span",null,e)}:"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r||(e.render=function(e){return a.createElement("span",null,e.toString())}):e.render=function(e){return a.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return a.createElement("span",null,JSON.stringify(e).substring(0,300))}},n.update=function(e,t){n.setState({config:t});var a=[],r={},s=[],i=Object(m.a)(Object(m.a)(n));e.forEach(function(t){for(var n in t)if(!r[n]){var s={title:n,dataIndex:n,key:n};i.setRender(s,e),a.push(s),r[n]=!0}}),e.forEach(function(e,t){var n={};a.forEach(function(t){n[t.key]=e[t.key]}),n.key=t,s.push(n)}),n.setState({columns:a,data:s})},n.state={columns:[],rows:[]},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(ie.a,{columns:this.state.columns,dataSource:this.state.data}))}}]),t}(a.Component),oe=n(603),le=n(130),ue=n(266),de=n(265),me=n(263),fe=n.n(me),pe={width:200,height:200,borderWidth:2,borderColor:"#666",borderStyle:"dashed",borderRadius:5},he={borderStyle:"solid",borderColor:"#6c6",backgroundColor:"#eee"},ge={borderStyle:"solid",borderColor:"#c66",backgroundColor:"#eee"},be={display:"flex"},ve=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).onDrop=function(t){e.setState({files:t});var n=fe.a.post(I);n.set("Access-Token",sessionStorage.getItem(j.name)||""),t.forEach(function(e){n.attach(e.path,e)}),n.end(function(n,a){e.setState({files:[]}),n?(console.log(n),e.setState({msg:n.toString()+"\n Sometimes this caused by your upload space is not enough."})):a.ok&&e.setState({msg:"total files:"+t.length+" are uploaded"})})},e.state={files:[]},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.state.files.map(function(e){return r.a.createElement("li",{key:e.name},e.path," - ",e.size," bytes")});return r.a.createElement("section",{style:be},r.a.createElement("div",null,r.a.createElement(ue.a,{onDrop:this.onDrop,getDataTransferItems:function(e){return Object(de.a)(e)}},function(e){var t=e.getRootProps,n=e.getInputProps,a=e.isDragActive,s=e.isDragAccept,i=e.isDragReject,c=(e.acceptedFiles,e.rejectedFiles,Object(le.a)({},pe));return c=a?Object(le.a)({},c,he):c,c=i?Object(le.a)({},c,ge):c,r.a.createElement("div",Object.assign({},t(),{style:c}),r.a.createElement("input",n()),r.a.createElement("div",null,s?"Drop":"Drag"," files here..."),i&&r.a.createElement("div",null,"Unsupported file type..."))})),r.a.createElement("aside",null,r.a.createElement("h4",null,0==e.length?"":"Files"),r.a.createElement("ul",null,e)),r.a.createElement("div",null,this.state.msg?this.state.msg:""))}}]),t}(r.a.Component),Ee=(n(481),n(175)),Oe=n(602),je=n(176),ke=n.n(je),Se=oe.a.Panel,ye=Oe.a.TabPane;function we(e){}var Te=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).isStream=function(e){if(e.length<1)return!1;try{if(!JSON.parse(e[0].value).runId)return!1}catch(t){return!1}return!0},n.renderDash=function(){var e=n.state.data;return n.isStream(e)?r.a.createElement("div",null,r.a.createElement(Ee.TimelineChart,{height:200,data:n.state.dataForRender,titleMap:n.state.titleMap}),r.a.createElement(Ee.TimelineChart,{height:200,data:n.state.dataForRender2,titleMap:n.state.titleMap2})):r.a.createElement("div",null)},n.renderStream=function(){var e=n.state.data;if(n.isStream(e)){var t=[],a=[];e.forEach(function(e){var n=JSON.parse(e.value);t.push({x:ke.a.utc(n.timestamp).toDate().getTime(),y1:n.inputRowsPerSecond,y2:n.processedRowsPerSecond}),a.push({x:ke.a.utc(n.timestamp).toDate().getTime(),y1:n.numInputRows})}),n.setState({dataForRender:t,titleMap:{y1:"inputRowsPerSecond",y2:"processedRowsPerSecond"},dataForRender2:a,titleMap2:{y1:"numInputRows"}})}},n.renderRawData=function(){var e=n.state.data;if(!n.isStream(e))return"";var t=[];return e.forEach(function(e){var n=JSON.parse(e.value);t.push(JSON.stringify(n,null,2))}),t.join("\n")},n.queryApp=e.parent,n.state={data:[],dataForRender:[],titleMap:{}},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"refresh",value:function(){try{var e=this.queryApp.queryResData||[];this.setState({data:e}),this.renderStream()}catch(t){}}},{key:"render",value:function(){return r.a.createElement(oe.a,{onChange:we},r.a.createElement(Se,{header:"Tools/Dashboard",key:"1"},r.a.createElement(Oe.a,{defaultActiveKey:"1",onChange:we},r.a.createElement(ye,{tab:"Upload",key:"1"},r.a.createElement(ve,null)),r.a.createElement(ye,{tab:"Dashboard",key:"2"},this.renderDash()),r.a.createElement(ye,{tab:"RawData",key:"3"},r.a.createElement("pre",null,this.renderRawData())))))}}]),t}(a.Component),Ce=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).setData=function(e){n.queryResData=e,n.dash.current.refresh()},n.state={sqlContent:""},n.directoryTree=r.a.createRef(),n.editor=r.a.createRef(),n.messageBox=r.a.createRef(),n.display=r.a.createRef(),n.dash=r.a.createRef(),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"mlsql-queryapp"},r.a.createElement("div",{className:"mlsql-directory-tree"},r.a.createElement(ae,{ref:this.directoryTree,parent:this})),r.a.createElement("div",{className:"mlsql-editor"},r.a.createElement(z,{ref:this.editor,parent:this}),r.a.createElement("div",{className:"mlsql-messagebox"},r.a.createElement(A.a,{height:"100px",width:"100%",ref:this.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",null,r.a.createElement(Te,{ref:this.dash,parent:this})),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(ce,{ref:this.display,parent:this}))))}}]),t}(a.Component),Ne="cluster",xe="console",Re="BackendForm",qe="BackendList",De="SetBackendTags",Ie=n(605),Pe=n(598),Le=n(33),Ae=n(607),Be=(n(595),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e)))._submit=function(){var e=n.state,t=e.name,a=e.url,r=e.tag,s=new w(D),i=Object(m.a)(Object(m.a)(n));s.request2({action:"/backend/add",name:t,tag:r,url:a},function(e){i.clusterMainPage.switchToBackendList()},function(e){n.setState({msg:e})})},n.submit=function(){n.validateForm()},n.validateForm=function(){var e=n.state,t=e.name,a=e.url,r=e.tag;if(t&&a&&r)if(a.includes(":")){var s=Object(m.a)(Object(m.a)(n));new w(D).request2({action:"/backend/list"},function(e){new Set(e.map(function(e){return e.name})).has(t)?n.setState({msg:"".concat(t," exists")}):s._submit()},function(e){n.setState({msg:e})})}else n.setState({msg:"".concat(a," should format like: ip/dns:port  ")});else n.setState({msg:"name, url ,tag should not empty"})},n.setName=function(e){n.setState({name:e.target.value})},n.setTag=function(e){n.setState({tag:e.target.value})},n.setUrl=function(e){n.setState({url:e.target.value})},n.state={msg:""},n.clusterMainPage=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(b.a,{helperText:"name",label:"the name of backend",labelFor:"name",labelInfo:"(required)"},a.createElement(v.a,{id:"name",onChange:this.setName,placeholder:"name"})),a.createElement(b.a,{helperText:"multi tag please use comma separate",label:"tag",labelFor:"tag",labelInfo:"(required)"},a.createElement(v.a,{id:"tag",onChange:this.setTag,placeholder:"tag"})),a.createElement(b.a,{helperText:"address",label:"url",labelFor:"url",labelInfo:"(required)"},a.createElement(v.a,{id:"url",onChange:this.setUrl,placeholder:"url e.g. 127.0.0.1:9003"})),a.createElement(h.a,{type:"submit",text:"Add",onClick:this.submit}),""!==this.state.msg&&a.createElement("div",{className:"mlsql-backend-messagebox"},this.state.msg))}}]),t}(a.Component)),Fe=n(250),Ve=Fe.a.Option,Me=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).renderTags=function(){var e=Object(m.a)(Object(m.a)(n));new w(D).request2({action:"/backend/list"},function(t){t.forEach(function(t){t.tag.split(",").forEach(function(t){e.state.renderTags.push(a.createElement(Ve,{key:t},t))})})},function(t){e.setState({msg:t})})},n.renderUsers=function(){var e=Object(m.a)(Object(m.a)(n));new w(C).request2({},function(t){t.forEach(function(t){e.state.renderUsers.push(a.createElement(Ve,{key:t},t))})},function(t){e.setState({msg:t})})},n.setTag=function(e){n.setState({updateTag:e})},n.setUser=function(e){n.setState({updateUser:e})},n.setDefaultBackend=function(){var e=Object(m.a)(Object(m.a)(n)),t=new w(T),a=(n.state.updateTag||[]).join(","),r=(n.state.updateUser||[]).join(",");a&&t.request2({backendTags:a,users:r},function(t){e.mainPage.switchToBackendList()},function(t){e.setState({msg:t})})},n.mainPage=e.parent,n.state={tags:[],renderTags:[],renderUsers:[]},n.tagSelectRef=a.createRef(),n.userSelectRef=a.createRef();var r=Object(m.a)(Object(m.a)(n));return(new P).user(function(e){e.userName;var t=e.backendTags;t&&(console.log(t.split(",")),r.setState({tags:t.split(",")})),r.renderTags(),r.renderUsers()}),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",null,"Backend Tag:",a.createElement("div",{style:{margin:"10px 0px"}},a.createElement(Fe.a,{mode:"multiple",style:{width:"100%"},placeholder:"Please select",onChange:this.setTag,ref:this.tagSelectRef},this.state.renderTags)),"For Users:",a.createElement("div",{style:{margin:"10px 0px"}},a.createElement(Fe.a,{mode:"multiple",style:{width:"100%"},placeholder:"Please select",onChange:this.setUser,ref:this.userSelectRef},this.state.renderUsers)),a.createElement(B.a,{type:"primary",onClick:function(){e.setDefaultBackend()}},"Update"),a.createElement("div",null),this.state.msg&&a.createElement("div",{className:"mlsql-backend-messagebox"},this.state.msg))}}]),t}(a.Component),_e=Ie.a.Header,Ue=Ie.a.Content,Ge=Ie.a.Footer,Je=Ie.a.Sider,ze=(Pe.a.SubMenu,function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).deleteBackend=function(e){var t=Object(m.a)(Object(m.a)(n));new w(D).request2({id:e,action:"/backend/remove"},function(e){t.switchToBackendList()},function(e){})},n.loadBackends=function(){var e=Object(m.a)(Object(m.a)(n)),t=new w(D);(new P).user(function(n){n.userName;var r=n.backendTags;t.request2({action:"/backend/list"},function(t){t.forEach(function(t){var n="";r==t.tag&&(n=a.createElement(B.a,{disabled:!0,style:{color:"green"},type:"primary"},"Active")),t.status=n,t.operator=a.createElement("div",null,a.createElement(B.a,{type:"danger",onClick:function(){e.deleteBackend(t.id)}},"delete")),delete t.tags}),e.tableDisplayRef.current.update(t,{render:{operator:function(e){return a.createElement("span",null,e)},status:function(e){return a.createElement("span",null,e)}}})},function(e){})})},n.switchToBackendForm=function(){n.setState({currentView:Re})},n.switchToBackendList=function(){n.setState({currentView:qe}),n.loadBackends()},n.switchToSetBackendTags=function(){n.setState({currentView:De})},n.renderView=function(){return n.state.currentView==qe?(n.loadBackends(),a.createElement(ce,{ref:n.tableDisplayRef,parent:Object(m.a)(Object(m.a)(n))})):n.state.currentView==Re?a.createElement(Be,{ref:n.backendFormRef,parent:Object(m.a)(Object(m.a)(n))}):n.state.currentView==De?a.createElement(Me,{ref:n.setBackendTagsViewRef,parent:Object(m.a)(Object(m.a)(n))}):void 0},n.renderViewIndex=function(){return n.state.currentView==qe?"1":n.state.currentView==Re?"2":n.state.currentView==De?"3":"1"},n.onCollapse=function(e){n.setState({collapsed:e})},n.state={collapsed:!1,currentView:qe},n.tableDisplayRef=a.createRef(),n.backendFormRef=a.createRef(),n.setBackendTagsViewRef=a.createRef(),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement(Ie.a,{style:{minHeight:"100vh"}},a.createElement(Je,{collapsible:!0,collapsed:this.state.collapsed,onCollapse:this.onCollapse},a.createElement("div",{className:"logo"}),a.createElement(Pe.a,{theme:"dark",defaultSelectedKeys:[this.renderViewIndex()],mode:"inline"},a.createElement(Pe.a.Item,{key:"1"},a.createElement(Le.a,{type:"desktop"}),a.createElement("span",null,a.createElement("a",{style:{color:"white"},onClick:this.switchToBackendList},"List Backend"))),a.createElement(Pe.a.Item,{key:"2"},a.createElement(Le.a,{type:"desktop"}),a.createElement("span",null,a.createElement("a",{style:{color:"white"},onClick:this.switchToBackendForm},"Add Backend"))),a.createElement(Pe.a.Item,{key:"3"},a.createElement(Le.a,{type:"desktop"}),a.createElement("span",null,a.createElement("a",{style:{color:"white"},onClick:this.switchToSetBackendTags},"Set Console Backend"))))),a.createElement(Ie.a,null,a.createElement(_e,{style:{background:"#fff",padding:0}}),a.createElement(Ue,{style:{margin:"0 16px"}},a.createElement(Ae.a,{style:{margin:"16px 0"}},a.createElement(Ae.a.Item,null)),a.createElement("div",{style:{padding:24,background:"#fff",minHeight:360}},this.renderView())),a.createElement(Ge,{style:{textAlign:"center"}})))}}]),t}(a.Component)),We=function(e){function t(e){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(ze,null))}}]),t}(a.Component),He="login",Qe="register",Ke=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).getLoginOrRegisterManager=function(){return n.app.registerOrLoginRef.current},n.logout=function(){n.auth.logout(),n.app.updateLoginoutStatus()},n.login=function(){n.logout(),n.getLoginOrRegisterManager().setState({loginType:He})},n.register=function(){n.logout(),n.getLoginOrRegisterManager().setState({loginType:Qe})},n.updateLoginoutStatus=function(){n.setState({isLogin:n.auth.isLogin()})},n.auth=new P,n.state={isLogin:n.auth.isLogin()},n.app=n.props.parent,n.auth.userName(function(e){n.setState({userName:e})}),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=a.createElement(h.a,{className:"bp3-minimal",icon:"log-in",text:"Login",onClick:this.login}),t=a.createElement(h.a,{className:"bp3-minimal",icon:"log-out",text:"Logout",onClick:this.logout}),n=a.createElement(h.a,{className:"bp3-minimal",icon:"intersection",text:"Register",onClick:this.register});return a.createElement("div",null,this.state.isLogin?"welcome  "+this.state.userName:"",this.state.isLogin?t:e,n)}}]),t}(a.Component),Ye=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).currentView=function(){return n.app.state.currentView},n.userName=function(e){n.setState({userName:e.target.value})},n.password=function(e){n.setState({password:e.target.value})},n.updateLoginoutStatus=function(){n.setState({isLogin:n.auth.isLogin()})},n.registerSuccess=function(e){if(e.status===O.Success)n.setState({registerOrLoginSuccess:!0}),n.app.updateLoginoutStatus();else{var t=Object(m.a)(Object(m.a)(n)),a=function(e){var n=e;try{n=JSON.parse(e).msg}catch(a){}t.setState({msg:n})};e.content.then(a).catch(a)}},n.registerFail=function(e){n.setState({msg:e.value.message})},n.login=function(){new Ze(Object(m.a)(Object(m.a)(n))).validate()&&n.auth.login(n.state.userName,n.state.password,n.registerSuccess,n.registerFail)},n.register=function(){new Ze(Object(m.a)(Object(m.a)(n))).validate()&&n.auth.register(n.state.userName,n.state.password,n.registerSuccess,n.registerFail)},n.auth=new P,n.app=n.props.parent,n.state={registerOrLoginSuccess:!1,msg:"",isLogin:n.auth.isLogin(),loginType:n.props.loginType||He},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.isLogin&&this.currentView()==xe?a.createElement(Ce,null):this.state.isLogin&&this.currentView()==Ne?a.createElement(We,null):a.createElement("div",{className:"mlsql-register"},a.createElement("div",{className:"mlsql-register-form"},a.createElement(b.a,{helperText:"email",label:"userName",labelFor:"userName",labelInfo:"(required)"},a.createElement(v.a,{id:"userName",placeholder:"email",onChange:this.userName})),a.createElement(b.a,{helperText:"password",label:"password",labelFor:"password",labelInfo:"(required)"},a.createElement(v.a,{id:"password",type:"password",placeholder:"password",onChange:this.password})),a.createElement(h.a,{type:"submit",text:this.state.loginType===He?"Login":"Register",onClick:this.state.loginType===He?this.login:this.register}),""!==this.state.msg&&a.createElement("div",{className:"mlsql-register-messagebox"},this.state.msg)))}}]),t}(a.Component),Ze=function(){function e(t){Object(c.a)(this,e),this.parent=t}return Object(o.a)(e,[{key:"validate",value:function(){return this.validateUserName()&&this.validatePassword()}},{key:"validateUserName",value:function(){var e=/[a-zA-Z0-9]+[\.]?([a-zA-Z0-9]+)?[\@][a-z]{3,9}[\.][a-z]{2,5}/g.test(this.parent.state.userName);return e||this.parent.setState({msg:"userName should be email"}),e}},{key:"validatePassword",value:function(){var e=this.parent.state.password.length>=4;return e||this.parent.setState({msg:"the length of password should > 4"}),e}}]),e}(),$e=function(e,t,n){g.a[e]({message:t,description:n})},Xe=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateLoginoutStatus=function(){n.menuRef.current.updateLoginoutStatus(),n.registerOrLoginRef.current.updateLoginoutStatus()},n.switchToCluster=function(){var e=new P,t=Object(m.a)(Object(m.a)(n));e.user(function(e){console.log(e.role),"admin"==e.role?t.setState({currentView:Ne}):$e("error","Auth Fail","You are not allow to visit Cluster Manager")})},n.switchToConsole=function(){n.setState({currentView:xe})},n.switchToCnDoc=function(){window.open("http://docs.mlsql.tech/zh/","_blank")},n.menuRef=r.a.createRef(),n.registerOrLoginRef=r.a.createRef(),n.state={currentView:xe},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(f.a,null,r.a.createElement(f.a.Group,{align:p.a.LEFT},r.a.createElement(f.a.Heading,null,"MLSQL Web Console"),r.a.createElement(f.a.Divider,null),r.a.createElement(h.a,{className:"bp3-minimal",icon:"home",text:"Console",onClick:this.switchToConsole}),r.a.createElement(h.a,{className:"bp3-minimal",icon:"document",text:"Cluster",onClick:this.switchToCluster}),r.a.createElement(h.a,{className:"bp3-minimal",icon:"document",text:"\u4e2d\u6587\u6587\u6863",onClick:this.switchToCnDoc})),r.a.createElement(f.a.Group,{align:p.a.RIGHT},r.a.createElement(Ke,{ref:this.menuRef,parent:this}))),r.a.createElement(Ye,{ref:this.registerOrLoginRef,parent:this,loginType:He}))}}]),t}(a.Component);i.a.render(r.a.createElement(Xe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[304,2,1]]]);
//# sourceMappingURL=main.01ed82de.chunk.js.map