(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{222:function(e,t,n){e.exports=n(409)},227:function(e,t,n){},231:function(e,t,n){},233:function(e,t,n){},235:function(e,t,n){},248:function(e,t,n){},294:function(e,t,n){},306:function(e,t,n){},409:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(9),o=n.n(i);n(227),n(231),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var s=n(15),c=n(20),l=n(25),u=n(23),d=n(24),p=(n(233),n(125)),m=n(36),f=n(126),h=n(13),g=n(123),v=n(124),b=(n(235),{GET:"get",POST:"post",PUT:"put"}),O={Success:200,BadRequest:400,Unauthorized:401,Forbidden:404,ServerError:500},E="access-token",S=function e(t){Object(s.a)(this,e),this.value=t},j=function e(t,n,a){var r=this;Object(s.a)(this,e),this.json=function(e,t){r.content.then(function(n){try{var a=JSON.parse(n);e(a)}catch(r){t(n)}})},this.status=t,this.content=n,this.accessToken=a},N=function(){function e(t){Object(s.a)(this,e),this.url=t}return Object(c.a)(e,[{key:"request",value:function(e,t,n,a){e=e.toUpperCase();var r=[];for(var i in t){var o=encodeURIComponent(i),s=encodeURIComponent(t[i]);r.push(o+"="+s)}var c=this.url;return"GET"===e?(c=c+"?"+r,r=void 0):r=r.join("&"),fetch(c,{method:e,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(E)||""},body:r}).then(function(e){n(new j(e.status,e.text(),e.headers.get(E)))}).catch(function(e){a(new S(e))})}}]),e}(),y="/api_v1/script_file",C="/api_v1/script_file/remove",x="/api_v1/script_file/get",w="/api_v1/run/script",k=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,[{key:"isLogin",value:function(){return null!==sessionStorage.getItem(E)}},{key:"userName",value:function(e){new N("/api_v1/user/userName").request(b.GET,{},function(t){t.status===O.Unauthorized?sessionStorage.removeItem(E):t.content.then(function(t){e(JSON.parse(t).userName)}).catch(function(e){})},function(e){console.log(e)})}},{key:"login",value:function(e,t,n,a){this.registerOrLogin("/api_v1/user/login",e,t,n,a)}},{key:"logout",value:function(){sessionStorage.removeItem(E)}},{key:"register",value:function(e,t,n,a){this.registerOrLogin("/api_v1/user/register",e,t,n,a)}},{key:"registerOrLogin",value:function(e,t,n,a,r){var i={userName:t,password:n};new N(e).request(b.POST,i,function(e){e.accessToken&&sessionStorage.setItem(E,e.accessToken),a(e)},function(e){r(e)})}}]),e}(),L=(n(95),n(237),n(89)),T=n.n(L),q=(n(245),n(246),n(247),n(248),n(136),n(410)),I=n(251),R=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).text=function(e,t){n.setState({value:e,scriptId:t}),n.aceEditorRef.current.editor.setValue(e)},n.executeSave=function(){var e=new N(y),t=Object(h.a)(Object(h.a)(n)),a=n.getMessageBoxAceEditor();t.state.scriptId?e.request(b.POST,{id:t.state.scriptId,content:t.getAceEditor().getValue()},function(e){a.setValue("saved")},function(e){}):a.setValue("no file are opened, cannot executeSave")},n.executeQuery=function(){n.enterLoading();var e=new N(w),t=Object(h.a)(Object(h.a)(n));t.getMessageBoxAceEditor().setValue("");var a=t.getSelection(),r=t.getAllText(),i=I();""!==a&&(r=a);var o=new k,s=(new Date).getTime();function c(){return t.exitLoading(),(new Date).getTime()-s}o.userName(function(n){e.request(b.POST,{sql:r,owner:n,jobName:i,sessionPerUser:!0,show_stack:!0},function(e){e.json(function(e){try{t.getDisplay().update(e),t.getMessageBoxAceEditor().setValue("\nTime cost:"+c()+"ms")}catch(n){t.getMessageBoxAceEditor().setValue("Can not display the result. raw data:\n"+JSON.stringify(e))}},function(e){t.getMessageBoxAceEditor().setValue(e+"\nTime cost:"+c()+"ms")})},function(e){e.value().content(function(e){t.getMessageBoxAceEditor().setValue(e+"\nTime cost:"+c()+"ms")})})})},n.getAllText=function(){return n.getAceEditor().getValue()},n.getSelection=function(){var e=n.getAceEditor().getSelectionRange();return n.getAceEditor().session.getTextRange(e)},n.getAceEditor=function(){return n.aceEditorRef.current.editor},n.getMessageBoxAceEditor=function(){return n.queryApp.messageBox.current.editor},n.getDisplay=function(){return n.queryApp.display.current},n.enterLoading=function(){n.commandGroup.current.setState({loading:!0})},n.exitLoading=function(){n.commandGroup.current.setState({loading:!1})},n.queryApp=n.props.parent,n.aceEditorRef=a.createRef(),n.commandGroup=a.createRef(),n.state={value:"",loading:!1},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"onChange",value:function(e){}},{key:"render",value:function(){return a.createElement("div",{className:"mlsql-editor-area"},a.createElement("div",null,a.createElement(T.a,{ref:this.aceEditorRef,mode:"sql",theme:"github",width:"100%",height:"300px",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,value:"",editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}})),a.createElement(D,{ref:this.commandGroup,parent:this}))}}]),t}(a.Component),D=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={loading:!1},n.parent=e.parent,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.createElement("div",{className:"mslql-editor-buttons"},a.createElement(q.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"\u8fd0\u884c"),a.createElement(q.a,{onClick:this.parent.executeSave},"\u4fdd\u5b58"))}}]),t}(a.Component),A=R,M=n(122),P=n(305),B=n(112),F=n(113),G=n(111),_=n(413),V=n(114),J=n(115),U=n(3),z=n.n(U),W=(n(294),function e(){Object(s.a)(this,e),this.build=function(e){var t,n,a={},r=[];for(n=0;n<e.length;n+=1)a[e[n].id]=n,e[n].childNodes=[];for(n=0;n<e.length;n+=1)if(0!==(t=e[n]).parentId)try{e[a[t.parentId]].childNodes.push(t)}catch(i){console.log("------------"),console.log(t),console.log(a[t.parentId])}else r.push(t);return r}}),Q=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).reloadData=function(){var e=new N(y),t=Object(h.a)(Object(h.a)(n));e.request(b.GET,{},function(e){e.content.then(function(e){var n=[];try{n=JSON.parse(e||"[]")}catch(r){}var a=(new W).build(n).sort(function(e,t){return e.id-t.id});t.setState({nodes:a})})},function(e){})},n.isRootNode=function(e){return n.state.nodes[0].id===e},n.onNodeContextMenu=function(e,t,r){r.preventDefault();var i=Object(h.a)(Object(h.a)(n));_.a.show(a.createElement(Z,{parent:i,nodeId:e.id}),{left:r.clientX,top:r.clientY},function(){return n.setState({isContextMenuOpen:!1})}),n.setState({isContextMenuOpen:!0})},n.handNodeDoubleClick=function(e,t,a){if(e.isDir)e.isExpanded=!e.isExpanded,n.toggleIsExpanded(e.id,e.isExpanded);else{var r=new N(x),i=Object(h.a)(Object(h.a)(n));r.request(b.GET,{id:e.id},function(t){t.content.then(function(t){var n=JSON.parse(t||"{}");i.parent.editor.current.text(n.content,e.id)})},function(e){})}n.setState(n.state)},n.handleNodeClick=function(e,t,a){var r=e.isSelected;a.shiftKey||n.forEachNode(n.state.nodes,function(e){return e.isSelected=!1}),e.isSelected=null==r||!r,n.setState(n.state)},n.toggleIsExpanded=function(e,t){var a=new N(y);Object(h.a)(Object(h.a)(n));a.request(b.POST,{id:e,isExpanded:t},function(e){e.content.then(function(e){})},function(e){})},n.handleNodeCollapse=function(e){e.isExpanded=!1,n.setState(n.state)},n.handleNodeExpand=function(e){e.isExpanded=!0,n.setState(n.state)},n.state={isContextMenuOpen:!1,openCreateScriptDialog:!1},n.parent=n.props.parent,n.reloadData(),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(M.a,{contents:this.state.nodes,onNodeClick:this.handleNodeClick,onNodeCollapse:this.handleNodeCollapse,onNodeExpand:this.handleNodeExpand,onNodeContextMenu:this.onNodeContextMenu,onNodeDoubleClick:this.handNodeDoubleClick,className:"mlsql-directory-tree"}),this.state.openCreateScriptDialog?a.createElement(H,{nodeId:this.state.nodeId,parent:this,queryApp:this.parent}):"")}},{key:"forEachNode",value:function(e,t){if(null!=e){var n=!0,a=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t(s),this.forEachNode(s.childNodes,t)}}catch(c){a=!0,r=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}}}}]),t}(a.Component),H=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).title=function(){return n.props.parent.state.isDir?"Create Folder":"Create Script"},n.fileName=function(e){n.setState({fileName:e.target.value})},n.content=function(e){n.setState({content:e.target.value})},n.finish=function(){n.props.parent.setState({openCreateScriptDialog:!1}),n.props.parent.reloadData()},n.create=function(){var e=new N(y),t=Object(h.a)(Object(h.a)(n)),a={fileName:n.state.fileName,isDir:n.props.parent.state.isDir,content:n.state.content,parentId:n.props.nodeId};a.fileName?a.isDir||a.fileName.endsWith(".mlsql")?e.request(b.POST,a,function(e){e.status===O.Success?t.finish():e.content.then(function(e){n.setState({msg:e})})},function(e){t.setState({msg:"Server error"})}):n.setState({msg:"filename should be ends with .mlsql"}):n.setState({msg:"filename should not be empty"})},n.close=function(){var e=n.props.parent;e.setState({openCreateScriptDialog:!1}),e.reloadData()},n.state={msg:""},n.messageBox=n.props.queryApp.messageBox.current.editor,n.directoryTree=n.props.parent,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=z()(P.a.CARD,P.a.ELEVATION_4,"docs-md-overlay-example-transition");return a.createElement("div",null,a.createElement(B.a,{className:"msql-treenode-dialog",isOpen:!0,usePortal:!0},a.createElement("div",{className:e},a.createElement(F.a,null,this.title()," "),a.createElement("div",{className:"msql-treenode-dialog-form"},a.createElement("p",{style:{color:"red"}},this.state.msg),a.createElement(g.a,{helperText:"The file of name you want create.",label:"fileName",labelFor:"fileName",labelInfo:"(required)"},a.createElement(v.a,{id:"fileName",placeholder:"example.mlsql",onChange:this.fileName}))),a.createElement("br",null),a.createElement(f.a,{onClick:this.create},"Create"),a.createElement(f.a,{intent:G.a.DANGER,onClick:this.close,style:{float:"right"}},"Close"))))}}]),t}(a.Component),Z=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).removeFile=function(){var e=new N(C),t=Object(h.a)(Object(h.a)(n));e.request(b.POST,{id:t.nodeId},function(e){e.status===O.Success?t.parent.reloadData():e.content.then(function(e){t.parent.setState({msg:e})})},function(e){t.parent.setState({msg:"Server error"})})},n.isCreateProject=function(){return n.parent.isRootNode(n.nodeId)},n.createDocMenuItem=function(){if(!n.isCreateProject())return a.createElement(V.a,{icon:"document",text:"Create Script",onClick:function(){n.parent.setState({openCreateScriptDialog:!0,nodeId:n.nodeId,isDir:!1})}.bind(Object(h.a)(Object(h.a)(n)))})},n.createFolderTitle=function(){return n.isCreateProject()?"Create Project":"Create Folder"},n.deleteMenu=function(){if(!n.isCreateProject())return a.createElement(V.a,{icon:"remove",text:"Delete",onClick:function(){n.removeFile()}.bind(Object(h.a)(Object(h.a)(n)))})},n.parent=n.props.parent,n.nodeId=n.props.nodeId,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",null,a.createElement(J.a,null,this.createDocMenuItem(),a.createElement(V.a,{icon:"folder-new",text:this.createFolderTitle(),onClick:function(){e.parent.setState({openCreateScriptDialog:!0,nodeId:e.nodeId,isDir:!0})}.bind(this)}),this.deleteMenu()))}}]),t}(a.Component),$=(n(306),n(412)),K=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).update=function(e){var t=[],a={},r=[];e.forEach(function(e){for(var n in e)a[n]||(t.push({title:n,dataIndex:n,key:n}),a[n]=!0)}),e.forEach(function(e,n){var a={};t.forEach(function(t){a[t.key]=e[t.key]}),a.key=n,r.push(a)}),n.setState({columns:t,data:r})},n.state={columns:[],rows:[]},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement($.a,{columns:this.state.columns,dataSource:this.state.data}))}}]),t}(a.Component),X=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={sqlContent:""},n.directoryTree=r.a.createRef(),n.editor=r.a.createRef(),n.messageBox=r.a.createRef(),n.display=r.a.createRef(),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"mlsql-queryapp"},r.a.createElement("div",{className:"mlsql-directory-tree"},r.a.createElement(Q,{ref:this.directoryTree,parent:this})),r.a.createElement("div",{className:"mlsql-editor"},r.a.createElement(A,{ref:this.editor,parent:this}),r.a.createElement("div",{className:"mlsql-messagebox"},r.a.createElement(T.a,{height:"100px",width:"100%",ref:this.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(K,{ref:this.display,parent:this}))))}}]),t}(a.Component),Y="login",ee="register",te=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).getLoginOrRegisterManager=function(){return n.app.registerOrLoginRef.current},n.logout=function(){n.auth.logout(),n.app.updateLoginoutStatus()},n.login=function(){n.logout(),n.getLoginOrRegisterManager().setState({loginType:Y})},n.register=function(){n.logout(),n.getLoginOrRegisterManager().setState({loginType:ee})},n.updateLoginoutStatus=function(){n.setState({isLogin:n.auth.isLogin()})},n.auth=new k,n.state={isLogin:n.auth.isLogin()},n.app=n.props.parent,n.auth.userName(function(e){n.setState({userName:e})}),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=a.createElement(f.a,{className:"bp3-minimal",icon:"log-in",text:"Login",onClick:this.login}),t=a.createElement(f.a,{className:"bp3-minimal",icon:"log-out",text:"Logout",onClick:this.logout}),n=a.createElement(f.a,{className:"bp3-minimal",icon:"intersection",text:"Register",onClick:this.register});return a.createElement("div",null,this.state.isLogin?"welcome  "+this.state.userName:"",this.state.isLogin?t:e,n)}}]),t}(a.Component),ne=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).userName=function(e){n.setState({userName:e.target.value})},n.password=function(e){n.setState({password:e.target.value})},n.updateLoginoutStatus=function(){n.setState({isLogin:n.auth.isLogin()})},n.registerSuccess=function(e){if(e.status===O.Success)n.setState({registerOrLoginSuccess:!0}),n.app.updateLoginoutStatus();else{var t=Object(h.a)(Object(h.a)(n)),a=function(e){var n=e;try{n=JSON.parse(e).msg}catch(a){}t.setState({msg:n})};e.content.then(a).catch(a)}},n.registerFail=function(e){n.setState({msg:e.value.message})},n.login=function(){new ae(Object(h.a)(Object(h.a)(n))).validate()&&n.auth.login(n.state.userName,n.state.password,n.registerSuccess,n.registerFail)},n.register=function(){new ae(Object(h.a)(Object(h.a)(n))).validate()&&n.auth.register(n.state.userName,n.state.password,n.registerSuccess,n.registerFail)},n.auth=new k,n.app=n.props.parent,n.state={registerOrLoginSuccess:!1,msg:"",isLogin:n.auth.isLogin(),loginType:n.props.loginType||Y},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.isLogin?a.createElement(X,null):a.createElement("div",{className:"mlsql-register"},a.createElement("div",{className:"mlsql-register-form"},a.createElement(g.a,{helperText:"email",label:"userName",labelFor:"userName",labelInfo:"(required)"},a.createElement(v.a,{id:"userName",placeholder:"email",onChange:this.userName})),a.createElement(g.a,{helperText:"password",label:"password",labelFor:"password",labelInfo:"(required)"},a.createElement(v.a,{id:"password",type:"password",placeholder:"password",onChange:this.password})),a.createElement(f.a,{type:"submit",text:this.state.loginType===Y?"Login":"Register",onClick:this.state.loginType===Y?this.login:this.register}),""!==this.state.msg&&a.createElement("div",{className:"mlsql-register-messagebox"},this.state.msg)))}}]),t}(a.Component),ae=function(){function e(t){Object(s.a)(this,e),this.parent=t}return Object(c.a)(e,[{key:"validate",value:function(){return this.validateUserName()&&this.validatePassword()}},{key:"validateUserName",value:function(){var e=/[a-zA-Z0-9]+[\.]?([a-zA-Z0-9]+)?[\@][a-z]{3,9}[\.][a-z]{2,5}/g.test(this.parent.state.userName);return e||this.parent.setState({msg:"userName should be email"}),e}},{key:"validatePassword",value:function(){var e=this.parent.state.password.length>=4;return e||this.parent.setState({msg:"the length of password should > 4"}),e}}]),e}(),re=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateLoginoutStatus=function(){n.menuRef.current.updateLoginoutStatus(),n.registerOrLoginRef.current.updateLoginoutStatus()},n.menuRef=r.a.createRef(),n.registerOrLoginRef=r.a.createRef(),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(p.a,null,r.a.createElement(p.a.Group,{align:m.a.LEFT},r.a.createElement(p.a.Heading,null,"MLSQL Web Console"),r.a.createElement(p.a.Divider,null),r.a.createElement(f.a,{className:"bp3-minimal",icon:"home",text:"Console"}),r.a.createElement(f.a,{className:"bp3-minimal",icon:"document",text:"Jobs"})),r.a.createElement(p.a.Group,{align:m.a.RIGHT},r.a.createElement(te,{ref:this.menuRef,parent:this}))),r.a.createElement(ne,{ref:this.registerOrLoginRef,parent:this,loginType:Y}))}}]),t}(a.Component);o.a.render(r.a.createElement(re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[222,2,1]]]);
//# sourceMappingURL=main.918b777c.chunk.js.map