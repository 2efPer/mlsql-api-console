(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{297:function(e,t,n){e.exports=n(584)},302:function(e,t,n){},306:function(e,t,n){},308:function(e,t,n){},310:function(e,t,n){},325:function(e,t,n){},367:function(e,t,n){},379:function(e,t,n){},582:function(e,t,n){},584:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(9),i=n.n(s);n(302),n(306),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=n(16),o=n(18),l=n(20),u=n(19),d=n(21),m=n(12),f=(n(308),n(244)),p=n(90),g=n(246),h=n(593),b=n(185),v=n(186),O=(n(310),{GET:"get",POST:"post",PUT:"put"}),E={Success:200,BadRequest:400,Unauthorized:401,Forbidden:404,ServerError:500},j="access-token",k=n(162),y=function e(t){Object(c.a)(this,e),this.value=t},S=function e(t,n,a){var r=this;Object(c.a)(this,e),this.json=function(e,t){r.content.then(function(n){try{var a=JSON.parse(n);e(a)}catch(r){t(n)}})},this.status=t,this.content=n,this.accessToken=a},w=function(){function e(t){Object(c.a)(this,e),this.url=t}return Object(o.a)(e,[{key:"request2",value:function(e,t,n){this.request(O.POST,e,function(e){e.json(function(e){t(e)},function(e){n(e)})},function(e){try{e.value().content(function(e){n(e)})}catch(t){n(e?e.toString():"result is null")}})}},{key:"runScript",value:function(e,t,n,a){var r=new L,s=k(),i=this;r.user(function(r){var c=r.userName,o=r.backendTags,l={sql:t,owner:c,jobName:s,sessionPerUser:!0,show_stack:!0,tags:o||""};Object.assign(l,e),(e.background||!1)&&Object.assign(l,{async:!0,callback:""}),i.request(O.POST,l,function(e){e.json(function(e){n(e)},function(e){a(e)})},function(e){try{e.value().content(function(e){a(e)})}catch(t){a(e?e.toString():"result is null")}})})}},{key:"request",value:function(e,t,n,a){e=e.toUpperCase();var r=[];for(var s in t){var i=encodeURIComponent(s),c=encodeURIComponent(t[s]);r.push(i+"="+c)}var o=this.url;return"GET"===e?(o=o+"?"+r,r=void 0):r=r.join("&"),fetch(o,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(j)||""},body:r}).then(function(e){n(new S(e.status,e.text(),e.headers.get(j)))}).catch(function(e){a(new y(e))})}}]),e}(),T="/api_v1/user/tags/update",C="/api_v1/script_file",N="/api_v1/script_file/remove",x="/api_v1/script_file/get",R="/api_v1/run/script",q="/api_v1/cluster",L=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"isLogin",value:function(){return null!==sessionStorage.getItem(j)}},{key:"userName",value:function(e){new w("/api_v1/user/userName").request(O.GET,{},function(t){t.status===E.Unauthorized?sessionStorage.removeItem(j):t.content.then(function(t){e(JSON.parse(t).userName)}).catch(function(e){})},function(e){console.log(e)})}},{key:"user",value:function(e){new w("/api_v1/user/userName").request2({},function(t){e(t)},function(e){})}},{key:"login",value:function(e,t,n,a){this.registerOrLogin("/api_v1/user/login",e,t,n,a)}},{key:"logout",value:function(){sessionStorage.removeItem(j)}},{key:"register",value:function(e,t,n,a){this.registerOrLogin("/api_v1/user/register",e,t,n,a)}},{key:"registerOrLogin",value:function(e,t,n,a,r){var s={userName:t,password:n};new w(e).request(O.POST,s,function(e){e.accessToken&&sessionStorage.setItem(j,e.accessToken),a(e)},function(e){r(e)})}}]),e}(),I=(n(128),n(314),n(119)),P=n.n(I),A=(n(322),n(323),n(324),n(325),n(167),n(245)),B=n(591),D=function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!==typeof Error)throw new Error(t);throw t}},V=n(162),M=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).text=function(e,t){n.setState({value:e,scriptId:t}),n.aceEditorRef.current.editor.setValue(e)},n.executeSave=function(){var e=new w(C),t=Object(m.a)(Object(m.a)(n)),a=n.getMessageBoxAceEditor();t.state.scriptId?e.request(O.POST,{id:t.state.scriptId,content:t.getAceEditor().getValue()},function(e){a.setValue("saved")},function(e){}):a.setValue("no file are opened, cannot executeSave")},n.executeQueryBackGround=function(){n.setState({background:!0}),n.executeQuery()},n.executeQuery=function(){var e=V();n.enterLoading(e);var t=new w(R),a=Object(m.a)(Object(m.a)(n));a.getMessageBoxAceEditor().setValue("");var r=a.getSelection(),s=a.getAllText();""!==r&&(s=r);var i=(new Date).getTime();function c(){return a.exitLoading(),(new Date).getTime()-i}t.runScript({jobName:e,background:n.state.background||!1},s,function(e){try{a.getDisplay().update(e),a.getMessageBoxAceEditor().setValue("\nTime cost:"+c()+"ms")}catch(t){a.getMessageBoxAceEditor().setValue("Can not display the result. raw data:\n"+JSON.stringify(e))}a.exitLoading()},function(e){a.getMessageBoxAceEditor().setValue(e+"\nTime cost:"+c()+"ms"),a.exitLoading()})},n.getAllText=function(){return n.getAceEditor().getValue()},n.getSelection=function(){var e=n.getAceEditor().getSelectionRange();return n.getAceEditor().session.getTextRange(e)},n.getAceEditor=function(){return n.aceEditorRef.current.editor},n.getMessageBoxAceEditor=function(){return n.queryApp.messageBox.current.editor},n.getDisplay=function(){return n.queryApp.display.current},n.enterLoading=function(e){n.commandGroup.current.setState({loading:!0}),n.resourceProgressRef.current.enter({jobName:e}),n.taskProgressRef.current.enter({jobName:e})},n.exitLoading=function(){n.commandGroup.current.setState({loading:!1}),n.resourceProgressRef.current.exit(),n.taskProgressRef.current.exit()},n.queryApp=n.props.parent,n.aceEditorRef=a.createRef(),n.commandGroup=a.createRef(),n.resourceProgressRef=a.createRef(),n.taskProgressRef=a.createRef(),n.state={value:"",loading:!1},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onChange",value:function(e){}},{key:"render",value:function(){return a.createElement("div",{className:"mlsql-editor-area"},a.createElement("div",null,a.createElement(P.a,{ref:this.aceEditorRef,mode:"sql",theme:"github",width:"100%",height:"300px",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,value:"",editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}})),a.createElement(F,{ref:this.commandGroup,parent:this}),a.createElement(_,{ref:this.resourceProgressRef,parent:this}),a.createElement(G,{ref:this.taskProgressRef,parent:this}))}}]),t}(a.Component),F=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={loading:!1},n.parent=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",{className:"mslql-editor-buttons"},a.createElement(A.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),a.createElement(A.a,{onClick:this.parent.executeSave},"Save"))}}]),t}(a.Component),_=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).enter=function(e){var t=Object(m.a)(Object(m.a)(n));n.setState({mark:!0}),setTimeout(function(){t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(function(){var n=new w(R);D(e.hasOwnProperty("jobName"),"jobName is required");var a=e.jobName;n.runScript({},"load _mlsql_.`resource/".concat(a,"` as output;"),function(e){var n=e[0];t.setState({percent:n.activeTasks/n.totalCores*100,successPercent:n.currentJobGroupActiveTasks/n.totalCores*100,title:"Resource (for all users): taken/Total: ".concat(n.activeTasks,"/").concat(n.totalCores,"(").concat(n.currentJobGroupActiveTasks," you took)")})},function(e){t.parent.getMessageBoxAceEditor().setValue(e)})},2e3))},3e3)},n.exit=function(){n.setState({loading:!1,percent:0,successPercent:0,mark:!1}),n.intervalTimer&&clearInterval(n.intervalTimer)},n.state={loading:!1,percent:0,successPercent:0,mark:!1},n.parent=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.loading?a.createElement("div",null,this.state.title,a.createElement(B.a,{percent:this.state.percent,successPercent:this.state.successPercent})):a.createElement("div",null)}}]),t}(a.Component),G=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).enter=function(e){var t=Object(m.a)(Object(m.a)(n));n.setState({mark:!0}),setTimeout(function(){t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(function(){var n=new w(R);D(e.hasOwnProperty("jobName"),"jobName is required");var a=e.jobName;n.runScript({},"load _mlsql_.`jobs/".concat(a,"` as output;"),function(e){var n=e[0],a={numTasks:0,numActiveTasks:0,numCompletedTasks:0};n.activeJobs.forEach(function(e){a.numTasks+=e.numTasks,a.numActiveTasks+=e.numActiveTasks,a.numCompletedTasks+=e.numCompletedTasks}),t.setState({percent:a.numActiveTasks/a.numTasks*100,successPercent:a.numCompletedTasks/a.numTasks*100,title:"Tasks (for all stages): Succeeded/Total:\n".concat(a.numCompletedTasks,"/").concat(a.numTasks,"(").concat(a.numActiveTasks," running)")})},function(e){t.parent.getMessageBoxAceEditor().setValue(e)})},2e3))},3e3)},n.exit=function(){n.setState({loading:!1,percent:0,successPercent:0,mark:!1}),n.intervalTimer&&clearInterval(n.intervalTimer)},n.state={loading:!1,percent:0,successPercent:0,mark:!1},n.parent=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.loading?a.createElement("div",null,this.state.title,a.createElement(B.a,{percent:this.state.percent,successPercent:this.state.successPercent})):a.createElement("div",null)}}]),t}(a.Component),J=M,U=n(184),z=n(378),H=n(146),Q=n(147),W=n(106),K=n(596),Y=n(148),Z=n(149),$=n(2),X=n.n($),ee=(n(367),function e(){Object(c.a)(this,e),this.build=function(e){var t,n,a={},r=[];for(n=0;n<e.length;n+=1)a[e[n].id]=n,e[n].childNodes=[];for(n=0;n<e.length;n+=1)if(0!==(t=e[n]).parentId)try{e[a[t.parentId]].childNodes.push(t)}catch(s){console.log("------------"),console.log(t),console.log(a[t.parentId])}else r.push(t);return r}}),te=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).reloadData=function(){var e=new w(C),t=Object(m.a)(Object(m.a)(n));e.request(O.GET,{},function(e){e.content.then(function(e){var n=[];try{n=JSON.parse(e||"[]")}catch(r){}var a=(new ee).build(n).sort(function(e,t){return e.id-t.id});t.setState({nodes:a})})},function(e){})},n.isRootNode=function(e){return n.state.nodes[0].id===e},n.onNodeContextMenu=function(e,t,r){r.preventDefault();var s=Object(m.a)(Object(m.a)(n));K.a.show(a.createElement(ae,{parent:s,nodeId:e.id}),{left:r.clientX,top:r.clientY},function(){return n.setState({isContextMenuOpen:!1})}),n.setState({isContextMenuOpen:!0})},n.handNodeDoubleClick=function(e,t,a){if(e.isDir)e.isExpanded=!e.isExpanded,n.toggleIsExpanded(e.id,e.isExpanded);else{var r=new w(x),s=Object(m.a)(Object(m.a)(n));r.request(O.GET,{id:e.id},function(t){t.content.then(function(t){var n=JSON.parse(t||"{}");s.parent.editor.current.text(n.content,e.id)})},function(e){})}n.setState(n.state)},n.handleNodeClick=function(e,t,a){var r=e.isSelected;a.shiftKey||n.forEachNode(n.state.nodes,function(e){return e.isSelected=!1}),e.isSelected=null==r||!r,n.setState(n.state)},n.toggleIsExpanded=function(e,t){var a=new w(C);Object(m.a)(Object(m.a)(n));a.request(O.POST,{id:e,isExpanded:t},function(e){e.content.then(function(e){})},function(e){})},n.handleNodeCollapse=function(e){e.isExpanded=!1,n.setState(n.state)},n.handleNodeExpand=function(e){e.isExpanded=!0,n.setState(n.state)},n.state={isContextMenuOpen:!1,openCreateScriptDialog:!1},n.parent=n.props.parent,n.reloadData(),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(U.a,{contents:this.state.nodes,onNodeClick:this.handleNodeClick,onNodeCollapse:this.handleNodeCollapse,onNodeExpand:this.handleNodeExpand,onNodeContextMenu:this.onNodeContextMenu,onNodeDoubleClick:this.handNodeDoubleClick,className:"mlsql-directory-tree"}),this.state.openCreateScriptDialog?a.createElement(ne,{nodeId:this.state.nodeId,parent:this,queryApp:this.parent}):"")}},{key:"forEachNode",value:function(e,t){if(null!=e){var n=!0,a=!1,r=void 0;try{for(var s,i=e[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var c=s.value;t(c),this.forEachNode(c.childNodes,t)}}catch(o){a=!0,r=o}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}}}}]),t}(a.Component),ne=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).title=function(){return n.props.parent.state.isDir?"Create Folder":"Create Script"},n.fileName=function(e){n.setState({fileName:e.target.value})},n.content=function(e){n.setState({content:e.target.value})},n.finish=function(){n.props.parent.setState({openCreateScriptDialog:!1}),n.props.parent.reloadData()},n.create=function(){var e=new w(C),t=Object(m.a)(Object(m.a)(n)),a={fileName:n.state.fileName,isDir:n.props.parent.state.isDir,content:n.state.content,parentId:n.props.nodeId};a.fileName?a.isDir||a.fileName.endsWith(".mlsql")?e.request(O.POST,a,function(e){e.status===E.Success?t.finish():e.content.then(function(e){n.setState({msg:e})})},function(e){t.setState({msg:"Server error"})}):n.setState({msg:"filename should be ends with .mlsql"}):n.setState({msg:"filename should not be empty"})},n.close=function(){var e=n.props.parent;e.setState({openCreateScriptDialog:!1}),e.reloadData()},n.state={msg:""},n.messageBox=n.props.queryApp.messageBox.current.editor,n.directoryTree=n.props.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=X()(z.a.CARD,z.a.ELEVATION_4,"docs-md-overlay-example-transition");return a.createElement("div",null,a.createElement(H.a,{className:"msql-treenode-dialog",isOpen:!0,usePortal:!0},a.createElement("div",{className:e},a.createElement(Q.a,null,this.title()," "),a.createElement("div",{className:"msql-treenode-dialog-form"},a.createElement("p",{style:{color:"red"}},this.state.msg),a.createElement(b.a,{helperText:"The file of name you want create.",label:"fileName",labelFor:"fileName",labelInfo:"(required)"},a.createElement(v.a,{id:"fileName",placeholder:"example.mlsql",onChange:this.fileName}))),a.createElement("br",null),a.createElement(g.a,{onClick:this.create},"Create"),a.createElement(g.a,{intent:W.a.DANGER,onClick:this.close,style:{float:"right"}},"Close"))))}}]),t}(a.Component),ae=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).removeFile=function(){var e=new w(N),t=Object(m.a)(Object(m.a)(n));e.request(O.POST,{id:t.nodeId},function(e){e.status===E.Success?t.parent.reloadData():e.content.then(function(e){t.parent.setState({msg:e})})},function(e){t.parent.setState({msg:"Server error"})})},n.isCreateProject=function(){return n.parent.isRootNode(n.nodeId)},n.createDocMenuItem=function(){if(!n.isCreateProject())return a.createElement(Y.a,{icon:"document",text:"Create Script",onClick:function(){n.parent.setState({openCreateScriptDialog:!0,nodeId:n.nodeId,isDir:!1})}.bind(Object(m.a)(Object(m.a)(n)))})},n.createFolderTitle=function(){return n.isCreateProject()?"Create Project":"Create Folder"},n.deleteMenu=function(){if(!n.isCreateProject())return a.createElement(Y.a,{icon:"remove",text:"Delete",onClick:function(){n.removeFile()}.bind(Object(m.a)(Object(m.a)(n)))})},n.parent=n.props.parent,n.nodeId=n.props.nodeId,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",null,a.createElement(Z.a,null,this.createDocMenuItem(),a.createElement(Y.a,{icon:"folder-new",text:this.createFolderTitle(),onClick:function(){e.parent.setState({openCreateScriptDialog:!0,nodeId:e.nodeId,isDir:!0})}.bind(this)}),this.deleteMenu()))}}]),t}(a.Component),re=(n(379),n(588)),se=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).setRender=function(e,t){var r=t[0][e.key];if(n.state.config&&n.state.config.render){var s=n.state.config.render[e.key];s&&(e.render=s)}else a.Component.isPrototypeOf(r.type)?e.render=function(e){return a.createElement("span",null,e)}:"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r||(e.render=function(e){return a.createElement("span",null,e.toString())}):e.render=function(e){return a.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return a.createElement("span",null,JSON.stringify(e).substring(0,300))}},n.update=function(e,t){n.setState({config:t});var a=[],r={},s=[],i=Object(m.a)(Object(m.a)(n));e.forEach(function(t){for(var n in t)if(!r[n]){var s={title:n,dataIndex:n,key:n};i.setRender(s,e),a.push(s),r[n]=!0}}),e.forEach(function(e,t){var n={};a.forEach(function(t){n[t.key]=e[t.key]}),n.key=t,s.push(n)}),n.setState({columns:a,data:s})},n.state={columns:[],rows:[]},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(re.a,{columns:this.state.columns,dataSource:this.state.data}))}}]),t}(a.Component),ie=n(590),ce=(n(469),n(257)),oe=n(585),le=ie.a.Panel,ue=oe.a.TabPane;function de(e){console.log(e)}for(var me=[],fe=0;fe<20;fe+=1)me.push({x:(new Date).getTime()+18e5*fe,y1:Math.floor(100*Math.random())+1e3,y2:Math.floor(100*Math.random())+10});var pe=function(e){function t(e){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(ie.a,{onChange:de},r.a.createElement(le,{header:"This is panel header 1",key:"1"},r.a.createElement(oe.a,{defaultActiveKey:"1",onChange:de},r.a.createElement(ue,{tab:"Dashboard",key:"1"},r.a.createElement(ce.TimelineChart,{height:200,data:me,titleMap:{y1:"\u5ba2\u6d41\u91cf",y2:"\u652f\u4ed8\u7b14\u6570"}})),r.a.createElement(ue,{tab:"RawData",key:"2"},"Content of Tab Pane 2")),","))}}]),t}(a.Component),ge=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={sqlContent:""},n.directoryTree=r.a.createRef(),n.editor=r.a.createRef(),n.messageBox=r.a.createRef(),n.display=r.a.createRef(),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"mlsql-queryapp"},r.a.createElement("div",{className:"mlsql-directory-tree"},r.a.createElement(te,{ref:this.directoryTree,parent:this})),r.a.createElement("div",{className:"mlsql-editor"},r.a.createElement(J,{ref:this.editor,parent:this}),r.a.createElement("div",{className:"mlsql-messagebox"},r.a.createElement(P.a,{height:"100px",width:"100%",ref:this.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",null,r.a.createElement(pe,null)),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(se,{ref:this.display,parent:this}))))}}]),t}(a.Component),he="cluster",be="console",ve="BackendForm",Oe="BackendList",Ee="SetBackendTags",je=n(594),ke=n(586),ye=n(11),Se=n(595),we=(n(582),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e)))._submit=function(){var e=n.state,t=e.name,a=e.url,r=e.tag,s=new w(q),i=Object(m.a)(Object(m.a)(n));s.request2({action:"/backend/add",name:t,tag:r,url:a},function(e){i.clusterMainPage.switchToBackendList()},function(e){n.setState({msg:e})})},n.submit=function(){n.validateForm()},n.validateForm=function(){var e=n.state,t=e.name,a=e.url,r=e.tag;if(t&&a&&r)if(a.includes(":")){var s=Object(m.a)(Object(m.a)(n));new w(q).request2({action:"/backend/list"},function(e){new Set(e.map(function(e){return e.name})).has(t)?n.setState({msg:"".concat(t," exists")}):s._submit()},function(e){n.setState({msg:e})})}else n.setState({msg:"".concat(a," should format like: ip/dns:port  ")});else n.setState({msg:"name, url ,tag should not empty"})},n.setName=function(e){n.setState({name:e.target.value})},n.setTag=function(e){n.setState({tag:e.target.value})},n.setUrl=function(e){n.setState({url:e.target.value})},n.state={msg:""},n.clusterMainPage=e.parent,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(b.a,{helperText:"name",label:"the name of backend",labelFor:"name",labelInfo:"(required)"},a.createElement(v.a,{id:"name",onChange:this.setName,placeholder:"name"})),a.createElement(b.a,{helperText:"multi tag please use comma separate",label:"tag",labelFor:"tag",labelInfo:"(required)"},a.createElement(v.a,{id:"tag",onChange:this.setTag,placeholder:"tag"})),a.createElement(b.a,{helperText:"address",label:"url",labelFor:"url",labelInfo:"(required)"},a.createElement(v.a,{id:"url",onChange:this.setUrl,placeholder:"url e.g. 127.0.0.1:9003"})),a.createElement(g.a,{type:"submit",text:"Add",onClick:this.submit}),""!==this.state.msg&&a.createElement("div",{className:"mlsql-backend-messagebox"},this.state.msg))}}]),t}(a.Component)),Te=n(589),Ce=n(592),Ne=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).tags=function(){var e=Object(m.a)(Object(m.a)(n));(new L).user(function(t){t.userName;var n=t.backendTags;e.setState({tags:n})})},n.renderTags=function(){var e=[];return n.state.tags&&n.state.tags.split(",").forEach(function(t){e.push(a.createElement(Te.a,{title:t}))}),e},n.setTag=function(e){n.setState({updateTag:e.target.value})},n.setDefaultBackend=function(){var e=Object(m.a)(Object(m.a)(n)),t=new w(T),a=n.state.updateTag;a&&t.request2({backendTags:a},function(t){e.mainPage.switchToSetBackendTags()},function(e){})},n.mainPage=e.parent,n.state={tags:""};var r=Object(m.a)(Object(m.a)(n));return(new L).user(function(e){e.userName;var t=e.backendTags;r.setState({tags:t})}),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",null,"New Tag:",a.createElement(Ce.a,{placeholder:"input tags",style:{width:200,margin:"10px 10px"},onChange:this.setTag}),a.createElement(A.a,{type:"primary",onClick:function(){e.setDefaultBackend()}},"Update"),a.createElement("div",{style:{display:"flex"}},this.renderTags()))}}]),t}(a.Component),xe=je.a.Header,Re=je.a.Content,qe=je.a.Footer,Le=je.a.Sider,Ie=(ke.a.SubMenu,function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).deleteBackend=function(e){var t=Object(m.a)(Object(m.a)(n));new w(q).request2({id:e},function(e){t.switchToBackendList()},function(e){})},n.loadBackends=function(){var e=Object(m.a)(Object(m.a)(n)),t=new w(q);(new L).user(function(n){n.userName;var r=n.backendTags;t.request2({action:"/backend/list"},function(t){t.forEach(function(t){var n="";r==t.tag&&(n=a.createElement(A.a,{disabled:!0,style:{color:"green"},type:"primary"},"Active")),t.status=n,t.operator=a.createElement("div",null,a.createElement(A.a,{type:"danger",onClick:function(){e.deleteBackend(t.id)}},"delete")),delete t.tags}),e.tableDisplayRef.current.update(t,{render:{operator:function(e){return a.createElement("span",null,e)},status:function(e){return a.createElement("span",null,e)}}})},function(e){})})},n.switchToBackendForm=function(){n.setState({currentView:ve})},n.switchToBackendList=function(){n.setState({currentView:Oe}),n.loadBackends()},n.switchToSetBackendTags=function(){n.setState({currentView:Ee})},n.renderView=function(){return n.state.currentView==Oe?(n.loadBackends(),a.createElement(se,{ref:n.tableDisplayRef,parent:Object(m.a)(Object(m.a)(n))})):n.state.currentView==ve?a.createElement(we,{ref:n.backendFormRef,parent:Object(m.a)(Object(m.a)(n))}):n.state.currentView==Ee?a.createElement(Ne,{ref:n.setBackendTagsViewRef,parent:Object(m.a)(Object(m.a)(n))}):void 0},n.renderViewIndex=function(){return n.state.currentView==Oe?"1":n.state.currentView==ve?"2":n.state.currentView==Ee?"3":"1"},n.onCollapse=function(e){n.setState({collapsed:e})},n.state={collapsed:!1,currentView:Oe},n.tableDisplayRef=a.createRef(),n.backendFormRef=a.createRef(),n.setBackendTagsViewRef=a.createRef(),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement(je.a,{style:{minHeight:"100vh"}},a.createElement(Le,{collapsible:!0,collapsed:this.state.collapsed,onCollapse:this.onCollapse},a.createElement("div",{className:"logo"}),a.createElement(ke.a,{theme:"dark",defaultSelectedKeys:[this.renderViewIndex()],mode:"inline"},a.createElement(ke.a.Item,{key:"1"},a.createElement(ye.a,{type:"desktop"}),a.createElement("span",null,a.createElement("a",{style:{color:"white"},onClick:this.switchToBackendList},"List Backend"))),a.createElement(ke.a.Item,{key:"2"},a.createElement(ye.a,{type:"desktop"}),a.createElement("span",null,a.createElement("a",{style:{color:"white"},onClick:this.switchToBackendForm},"Add Backend"))),a.createElement(ke.a.Item,{key:"3"},a.createElement(ye.a,{type:"desktop"}),a.createElement("span",null,a.createElement("a",{style:{color:"white"},onClick:this.switchToSetBackendTags},"Set Console Backend"))))),a.createElement(je.a,null,a.createElement(xe,{style:{background:"#fff",padding:0}}),a.createElement(Re,{style:{margin:"0 16px"}},a.createElement(Se.a,{style:{margin:"16px 0"}},a.createElement(Se.a.Item,null)),a.createElement("div",{style:{padding:24,background:"#fff",minHeight:360}},this.renderView())),a.createElement(qe,{style:{textAlign:"center"}})))}}]),t}(a.Component)),Pe=function(e){function t(e){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return a.createElement("div",null,a.createElement(Ie,null))}}]),t}(a.Component),Ae="login",Be="register",De=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).getLoginOrRegisterManager=function(){return n.app.registerOrLoginRef.current},n.logout=function(){n.auth.logout(),n.app.updateLoginoutStatus()},n.login=function(){n.logout(),n.getLoginOrRegisterManager().setState({loginType:Ae})},n.register=function(){n.logout(),n.getLoginOrRegisterManager().setState({loginType:Be})},n.updateLoginoutStatus=function(){n.setState({isLogin:n.auth.isLogin()})},n.auth=new L,n.state={isLogin:n.auth.isLogin()},n.app=n.props.parent,n.auth.userName(function(e){n.setState({userName:e})}),n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=a.createElement(g.a,{className:"bp3-minimal",icon:"log-in",text:"Login",onClick:this.login}),t=a.createElement(g.a,{className:"bp3-minimal",icon:"log-out",text:"Logout",onClick:this.logout}),n=a.createElement(g.a,{className:"bp3-minimal",icon:"intersection",text:"Register",onClick:this.register});return a.createElement("div",null,this.state.isLogin?"welcome  "+this.state.userName:"",this.state.isLogin?t:e,n)}}]),t}(a.Component),Ve=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).currentView=function(){return n.app.state.currentView},n.userName=function(e){n.setState({userName:e.target.value})},n.password=function(e){n.setState({password:e.target.value})},n.updateLoginoutStatus=function(){n.setState({isLogin:n.auth.isLogin()})},n.registerSuccess=function(e){if(e.status===E.Success)n.setState({registerOrLoginSuccess:!0}),n.app.updateLoginoutStatus();else{var t=Object(m.a)(Object(m.a)(n)),a=function(e){var n=e;try{n=JSON.parse(e).msg}catch(a){}t.setState({msg:n})};e.content.then(a).catch(a)}},n.registerFail=function(e){n.setState({msg:e.value.message})},n.login=function(){new Me(Object(m.a)(Object(m.a)(n))).validate()&&n.auth.login(n.state.userName,n.state.password,n.registerSuccess,n.registerFail)},n.register=function(){new Me(Object(m.a)(Object(m.a)(n))).validate()&&n.auth.register(n.state.userName,n.state.password,n.registerSuccess,n.registerFail)},n.auth=new L,n.app=n.props.parent,n.state={registerOrLoginSuccess:!1,msg:"",isLogin:n.auth.isLogin(),loginType:n.props.loginType||Ae},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.isLogin&&this.currentView()==be?a.createElement(ge,null):this.state.isLogin&&this.currentView()==he?a.createElement(Pe,null):a.createElement("div",{className:"mlsql-register"},a.createElement("div",{className:"mlsql-register-form"},a.createElement(b.a,{helperText:"email",label:"userName",labelFor:"userName",labelInfo:"(required)"},a.createElement(v.a,{id:"userName",placeholder:"email",onChange:this.userName})),a.createElement(b.a,{helperText:"password",label:"password",labelFor:"password",labelInfo:"(required)"},a.createElement(v.a,{id:"password",type:"password",placeholder:"password",onChange:this.password})),a.createElement(g.a,{type:"submit",text:this.state.loginType===Ae?"Login":"Register",onClick:this.state.loginType===Ae?this.login:this.register}),""!==this.state.msg&&a.createElement("div",{className:"mlsql-register-messagebox"},this.state.msg)))}}]),t}(a.Component),Me=function(){function e(t){Object(c.a)(this,e),this.parent=t}return Object(o.a)(e,[{key:"validate",value:function(){return this.validateUserName()&&this.validatePassword()}},{key:"validateUserName",value:function(){var e=/[a-zA-Z0-9]+[\.]?([a-zA-Z0-9]+)?[\@][a-z]{3,9}[\.][a-z]{2,5}/g.test(this.parent.state.userName);return e||this.parent.setState({msg:"userName should be email"}),e}},{key:"validatePassword",value:function(){var e=this.parent.state.password.length>=4;return e||this.parent.setState({msg:"the length of password should > 4"}),e}}]),e}(),Fe=function(e,t,n){h.a[e]({message:t,description:n})},_e=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateLoginoutStatus=function(){n.menuRef.current.updateLoginoutStatus(),n.registerOrLoginRef.current.updateLoginoutStatus()},n.switchToCluster=function(){var e=new L,t=Object(m.a)(Object(m.a)(n));e.user(function(e){console.log(e.role),"admin"==e.role?t.setState({currentView:he}):Fe("error","Auth Fail","You are not allow to visit Cluster Manager")})},n.switchToConsole=function(){n.setState({currentView:be})},n.menuRef=r.a.createRef(),n.registerOrLoginRef=r.a.createRef(),n.state={currentView:be},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(f.a,null,r.a.createElement(f.a.Group,{align:p.a.LEFT},r.a.createElement(f.a.Heading,null,"MLSQL Web Console"),r.a.createElement(f.a.Divider,null),r.a.createElement(g.a,{className:"bp3-minimal",icon:"home",text:"Console",onClick:this.switchToConsole}),r.a.createElement(g.a,{className:"bp3-minimal",icon:"document",text:"Cluster",onClick:this.switchToCluster})),r.a.createElement(f.a.Group,{align:p.a.RIGHT},r.a.createElement(De,{ref:this.menuRef,parent:this}))),r.a.createElement(Ve,{ref:this.registerOrLoginRef,parent:this,loginType:Ae}))}}]),t}(a.Component);i.a.render(r.a.createElement(_e,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[297,2,1]]]);
//# sourceMappingURL=main.205d811d.chunk.js.map